{% extends 'accounts/reports/financial_report.html' %}

{% block report_content %}
<div class="row">
    <!-- Financial Overview Card -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Financial Overview</h5>
                <ul class="list-unstyled">
                    <li><strong>Total Revenue:</strong> ${{ financial_summary.total_revenue }}</li>
                    <li><strong>Total Expenses:</strong> ${{ financial_summary.total_expenses }}</li>
                    <li><strong>Net Balance:</strong> ${{ financial_summary.net_balance }}</li>
                    <li><strong>Report Period:</strong> {{ start_date }} to {{ end_date }}</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Revenue Breakdown Card -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Revenue Breakdown</h5>
                <ul class="list-unstyled">
                    <li><strong>Tuition Fees:</strong> ${{ financial_summary.tuition_fees }}</li>
                    <li><strong>Registration Fees:</strong> ${{ financial_summary.registration_fees }}</li>
                    <li><strong>Other Fees:</strong> ${{ financial_summary.other_fees }}</li>
                </ul>
                <div class="mt-3">
                    <canvas id="revenueChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Expense Breakdown Card -->
    <div class="col-md-4">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Expense Breakdown</h5>
                <ul class="list-unstyled">
                    <li><strong>Salaries:</strong> ${{ financial_summary.salary_expenses }}</li>
                    <li><strong>Maintenance:</strong> ${{ financial_summary.maintenance_expenses }}</li>
                    <li><strong>Supplies:</strong> ${{ financial_summary.supplies_expenses }}</li>
                    <li><strong>Utilities:</strong> ${{ financial_summary.utilities_expenses }}</li>
                    <li><strong>Other:</strong> ${{ financial_summary.other_expenses }}</li>
                </ul>
                <div class="mt-3">
                    <canvas id="expenseChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Monthly Trends -->
<div class="row">
    <div class="col-12">
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">Monthly Financial Trends</h5>
                <div style="height: 300px;">
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'pie',
        data: {
            labels: ['Tuition', 'Registration', 'Other'],
            datasets: [{
                data: [
                    {{ financial_summary.tuition_fees }},
                    {{ financial_summary.registration_fees }},
                    {{ financial_summary.other_fees }}
                ],
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // Expense Chart
    const expenseCtx = document.getElementById('expenseChart').getContext('2d');
    new Chart(expenseCtx, {
        type: 'pie',
        data: {
            labels: ['Salaries', 'Maintenance', 'Supplies', 'Utilities', 'Other'],
            datasets: [{
                data: [
                    {{ financial_summary.salary_expenses }},
                    {{ financial_summary.maintenance_expenses }},
                    {{ financial_summary.supplies_expenses }},
                    {{ financial_summary.utilities_expenses }},
                    {{ financial_summary.other_expenses }}
                ],
                backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });

    // Trend Chart
    const trendCtx = document.getElementById('trendChart').getContext('2d');
    new Chart(trendCtx, {
        type: 'line',
        data: {
            labels: {{ monthly_labels|safe }},
            datasets: [{
                label: 'Revenue',
                data: {{ monthly_revenue }},
                borderColor: '#4e73df',
                fill: false
            }, {
                label: 'Expenses',
                data: {{ monthly_expenses }},
                borderColor: '#e74a3b',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value;
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endblock %} 